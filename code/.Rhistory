#### k -means  #######
require(textir);data(congress109);cl <- NULL
#load algorithm
source('Iterate.R')
X = congress109Counts
covars <- data.frame(gop=congress109Ideology$party=="R",
cscore=congress109Ideology$cs1)
covars$cscore <- covars$cscore -
tapply(covars$cscore,covars$gop,mean)[covars$gop+1]
rownames(covars) <- rownames(congress109Ideology)
##### random ##########
make_cl1 <- function(i) {sample(1:i,size=dim(X)[1],replace=TRUE)}##### random ##########make_cl1 <- function(i) {sample(1:i,size=dim(X)[1],replace=TRUE)}
make_cl2 <- function(i) {kmeans(X,i)$cluster}
##### k means on residuals#################
fits <- mnlm(cl, covars,X, bins=5, gamma=1, nlambda=10)
##############################################
m <- rowSums(we8thereCounts)
resids <- X-m*predict(fits,y,type="response") #(these are not really good residuals?)
make_cl3 <- function(i) {kmeans(resids,i)$cluster}# k mean
nloop = 15#test:
test.sim <- iter_cluster(covars,make_cl1(4),X,n.loop=4)
#Now I will test each cluster initialization, for 15 iterations,
sim.1 <- sim.2 <- sim.3<- list()
for (i in c(10,15)) {
  sim.1 <- append(sim.1,list(iter_cluster(covars,make_cl1(i),X,n.loop=nloop)))
  sim.2 <- append(sim.2,list(iter_cluster(covars,make_cl2(i),X,n.loop=nloop)))
  sim.3 <- append(sim.3,list(iter_cluster(covars,make_cl3(i),X,n.loop=nloop)))
}
ls()
str(sim.1)
str(sim.2)
str(sim.3)
save(sim.1)
save.image()
q()
source('Iterate.R')
multi.devian(X,covars,sim.1$B)
str(sim.1$B)
sim.1
str(sim.1)
multi.devian(X,covars,sim.1[[1]]$B)
multi.devian(X,as.matrix(covars),sim.1[[1]]$B)
source('Iterate.R')
multi.devian(X,as.matrix(covars),sim.1[[1]]$B)
fits <- mnlm(cl, covars,X, bins=5, gamma=1, nlambda=10)
library(textir)
fits <- mnlm(cl, covars,X, bins=5, gamma=1, nlambda=10)
multi.devian(X,as.matrix(covars),coef(fits))
head(sim.1[[1]]B)
head(sim.1[[1]]$B)
str(sim[[1]])
str(sim.1[[1]])
str(sim.1[[1]]$B)
dim(sim.1[[1]]$B)
sim.1[[1]]$B@Dimnames
sim.1[[1]]$B@Dimnames[[1]]
cl2 <- make_cl3(4)
make_cl3
make_cl3(4)
head(cl3)
cl3 <- make_cl3(4)
head(cl3)
p <- iter_cluster(covars,cl3,X,4)
cl2 <- make_cl2(4)
p <- iter_cluster(covars,cl2,X,4)
#Now I will test each cluster initialization, for 15 iterations,
sim.1 <- sim.2 <- sim.3<- list()
for (i in c(5,10)) {
for (nloop in c(10,15)) {
  sim.1 <- append(sim.1,list(iter_cluster(covars,make_cl1(i),X,n.loop=nloop)))
  sim.2 <- append(sim.2,list(iter_cluster(covars,make_cl2(i),X,n.loop=nloop)))
  sim.3 <- append(sim.3,list(iter_cluster(covars,make_cl3(i),X,n.loop=nloop)))
}}
q()
